<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.css" />
	<link rel="stylesheet" href="./css/css.css" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.js" /></script>
	<title>乗換案内設定</title>
</head>

<body>
<form>
<h2>設定</h2>

<p>乗車駅：<input type="text" id="start" class="small" placeholder="日本橋（東京）" style="width: 550px"></p>
<p>降車駅：<input type="text" id="end" class="small" placeholder="日本橋（大阪）" style="width: 550px"></p>
<p>経由駅：<input type="text" id="via" class="small" placeholder="東京ディズニーランド" style="width: 550px"></p>
<p> * ジョルダン乗換案内で認識できる駅名であること．</p>
<p> * 経由駅は試験的に導入しており，駅名候補が複数出るような駅だと上手く機能しません．</p>

<!-- <p><input type="submit" id="b-save" value="Save"></input></p> -->
<p><input type="button" id="b-save" value="Save"></input></p>
<p><input type="button" id="b-cancel" value="Cancel"></input></p>
</form>
<script>

// function getQuerystring(key, default_){
// 	if (default_==null) default_="";
//   key = key.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
//   var regex = new RegExp("[\\?&]"+key+"=([^&#]*)");
//   var qs = regex.exec(window.location.href);
//   if(qs == null){
// 		return default_;
// 	}else{
// 		return qs[1];
// 	}
// }

function saveOptions() {
	var sendValue = {'start':$('#start').val(), 'end':$('#end').val(), 'via':$('#via').val()};
	return sendValue;
}

$().ready(function(){
	var h = decodeURIComponent(document.location.hash).substr(1);
	//var h = decodeURIComponent(document.location.search).substr(1);
	alert(h);
	h=JSON.parse(h);

	if(!h.start){
		$('#start').val('');
	}else{
		$('#start').val(h.start);
	}
	if(!h.end){
		$('#end').val('');
	}else{
		$('#end').val(h.end);
	}
	if(!h.via){
		$('#via').val('');
	}else{
		$('#via').val(h.via);
	}

	$("#b-cancel").click(function(){
		//console.log("Canceling");
		document.location = "pebblejs://close";
	});

	$("#b-save").click(function() {
		//alert(encodeURIComponent(JSON.stringify(saveOptions())));
		var location_uri = "pebblejs://close#" + encodeURIComponent(JSON.stringify(saveOptions()));
		document.location = location_uri;
	});
});
</script>
</body>
</html>
